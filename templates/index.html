<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multilingual Translator</title>
</head>
<body>
  <h1>Multilingual Translator</h1>
  <form method="post">
    <!-- Source Language Selection -->
    <div>
      <label for="source_lang">Ancient Language:</label><br>
      <select id="source_lang" name="source_lang">
        {% for src in sources %}
          <option value="{{ src }}" {% if src == selected_source %}selected{% endif %}>{{ src }}</option>
        {% endfor %}
      </select>
    </div>
    <br>

    <!-- Text Input -->
    <div>
      <label for="text_input">Enter text:</label><br>
      <textarea id="text_input" name="text_input" rows="6" cols="60" placeholder="Paste your text here">{{ request.form.get('text_input', '') }}</textarea>
    </div>
    <br>

    <!-- Prompt Style Selection -->
    <div>
      <label for="prompt_style">Select prompt style:</label><br>
      <select id="prompt_style" name="prompt_style">
        {% for style in prompt_styles %}
          <option value="{{ style }}" {% if style == selected_prompt %}selected{% endif %}>{{ style }}</option>
        {% endfor %}
      </select>
    </div>
    <br>

    <button type="submit">Process</button>
  </form>

  {% if translation %}
    <h2>Translation</h2>
    <p>{{ translation }}</p>
  {% endif %}

  <script>
    // Mapping of sources to their prompt style keys, passed from Flask as 'prompt_map'
    const promptMap = {{ prompt_map | tojson }};
    const sourceSelect = document.getElementById('source_lang');
    const promptSelect = document.getElementById('prompt_style');

    sourceSelect.addEventListener('change', () => {
      const selected = sourceSelect.value;
      const styles = promptMap[selected] || [];
      // Clear existing options
      promptSelect.innerHTML = '';
      // Populate new options
      styles.forEach(style => {
        const opt = document.createElement('option');
        opt.value = style;
        opt.textContent = style;
        promptSelect.appendChild(opt);
      });
    });
  </script>
</body>
</html>
